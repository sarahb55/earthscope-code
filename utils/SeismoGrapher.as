package earthscope.utils{		import flash.display.Sprite;	import flash.display.Shape;    import flash.geom.Rectangle;    import flash.events.MouseEvent;	import flash.text.TextField;	import flash.text.TextFieldAutoSize;    import flash.text.TextFormat;	import flash.text.Font;	import flash.ui.Mouse;	import flash.filters.BevelFilter;	import flash.filters.BitmapFilterQuality;	import flash.filters.BitmapFilterType;	import flash.net.URLRequest;	import flash.utils.Timer;	import flash.events.TimerEvent;		public class SeismoGrapher extends Sprite{						private var nWidth:Number = 300;		private var nHeight:Number = 200;		private var nZeroX:Number = 15;		private var nZeroY:Number = 15;		private var xTop:Number = 0;		private var yTop:Number = 0;		private var xText:TextField = new TextField();		private var yText:TextField = new TextField();		private var format:TextFormat = new TextFormat();		private var myFont:Font = new Arial();		private var nMaxSeconds:Number = 5;		private var xMin:Number = 0;		private var xMax:Number = nMaxSeconds*60 + 35;		private var yMin:Number = -10;		private var yMax:Number = 3;		private var yDot:Number = (nHeight - nZeroY)/2;				private var inc:Number = Math.round(nWidth/nMaxSeconds) - 2;		private var hourPerDay :Number = 1.0;		private var pointsArray:Array = new Array();		private var labelText:TextField = new TextField();						private var sBackground:Sprite = new Sprite();				public function SeismoGrapher(w:Number=300, h:Number=200){			trace("Creating a GPS graph");			nWidth = w;			nHeight = h;			inc= Math.round(nWidth/nMaxSeconds) - 2;			drawBackground();			addChild(sBackground);			super();		}				override public function set width(v:Number):void{						if(v > 0){				nWidth = v;				sBackground.width = v;			}									drawBackground();					}				public function clampX(xVal):Number{						if(xVal > xMax){										xVal = xMax;			}			else if(xVal < xMin){										xVal = xMin;			}						return xVal;					}				public function clampY(yVal):Number{						if(yVal > yMax){										yVal = yMax;			}			else if(yVal < yMin){										yVal = yMin;			}						return yVal;					}						public function plot(dataArray:Array):void{						//Step 1 array is an oblect array of -- (time,value)						if(dataArray == null || dataArray.length < 2){				return;			}						drawBackground();						for(var i:Number = 0; i < dataArray.length - 2; i++){												//Convert each point to a position 				var xVal:Number = clampX(dataArray[i+1].x);				var yVal:Number = clampY(dataArray[i+1].y);												var xPrev = clampX(dataArray[i].x);				var yPrev = clampY(dataArray[i].y);																				//trace(xVal + " " + yVal);								xPrev = Math.round((nWidth - 2*nZeroX)*xPrev/(xMax - xMin) +  xTop + nZeroX);				yPrev = Math.round(nHeight - ((yPrev/(yMax - yMin))*(nHeight - nZeroY) + nZeroY)) - (nHeight - nZeroY)/2 ;								var xPos:Number = Math.round((nWidth - 2*nZeroX)*(xVal/(xMax - xMin)) +  xTop + nZeroX);				var yPos:Number = Math.round(nHeight - ((yVal/(yMax - yMin))*(nHeight - nZeroY) + nZeroY)) - (nHeight - nZeroY)/2  ;												//trace(xPos + " " + yPos);								sBackground.graphics.lineStyle(1, 0x000aff);												sBackground.graphics.moveTo(xPrev, yPrev);				sBackground.graphics.lineTo(xPos, yPos);								yDot = yPos;								//sBackground.graphics.lineStyle(1, 0xff00ff);				//sBackground.graphics.drawCircle(xPos, yPos, 2);																							}												//Draw a small circle at that point						//Draw a line to the next point 					}				override public function set height(v:Number):void{						if(v > 0){				nHeight = v;				sBackground.height = v;							}									drawBackground();					}				private function drawBackground(){						graphics.clear();			sBackground.graphics.clear();			sBackground.graphics.lineStyle(0, 0xFFFF99);						sBackground.graphics.moveTo( xTop, yTop);						with(sBackground.graphics){								beginFill(0x99FF99, 1);                drawRect(xTop, yTop, nWidth, nHeight);                endFill();							}		   			sBackground.graphics.lineStyle(1, 0xcc00ff);			sBackground.graphics.moveTo( xTop + nZeroX, yTop);			sBackground.graphics.lineTo(xTop + nZeroX, yTop + nHeight - nZeroY);			sBackground.graphics.lineTo(xTop + nWidth, yTop + nHeight - nZeroY);			sBackground.graphics.moveTo( xTop, yTop);						sBackground.graphics.lineStyle(2, 0x000066);						sBackground.graphics.lineStyle(1, 0x33ff99);			sBackground.graphics.moveTo( xTop + nZeroX, yTop + (nHeight - nZeroY)/2);			sBackground.graphics.lineTo( xTop + nWidth, yTop + (nHeight - nZeroY)/2);									for(var i:Number = 1; i < nMaxSeconds; ++i){				sBackground.graphics.lineStyle(1, 0x990066);				sBackground.graphics.drawCircle( xTop + nZeroX + inc*i, yTop + nHeight - nZeroY, 1);				var pos:Number =  xTop + nZeroX + inc*i;												if(i == nMaxSeconds - 1){					sBackground.graphics.lineStyle(1, 0x990066);					sBackground.graphics.moveTo( xTop + nZeroX + inc*i, yTop + nHeight - nZeroY);					sBackground.graphics.lineTo(xTop + nZeroX + inc*i,  yTop +  nZeroY);					labelText.x = xTop + nZeroX + inc*i - 10;					labelText.y = yTop + nHeight - 13;					sBackground.graphics.lineStyle(1, 0x990066);					sBackground.graphics.drawCircle(xTop + nZeroX + inc*i,  yTop +  nZeroY,1);					sBackground.graphics.lineStyle(5, 0x000aff);					sBackground.graphics.drawCircle(xTop + nZeroX + inc*i, yDot ,3);				}			}												format.font = myFont.fontName;			format.size = 9;									xText.x = xTop + nWidth/2 - 30;			xText.y = yTop + nHeight - 13;			xText.defaultTextFormat = format;			xText.text = "Hours";			sBackground.addChild(xText);			xText.embedFonts = true;			labelText.text = "Now"			labelText.defaultTextFormat = format;			labelText.embedFonts = true;			addChild(labelText);						sBackground.addChild(labelText);						yText.x = xTop + 1;			yText.y = yTop +2* nHeight/3 ;			yText.defaultTextFormat = format;			yText.text = "Position";			yText.width = 200;						sBackground.addChild(yText);			yText.embedFonts = true;			yText.rotation = 270;						sBackground.graphics.moveTo(xTop + nZeroX, yTop + nHeight - nZeroY);		}				public function clearGraph():void{						drawBackground();					}					}							}