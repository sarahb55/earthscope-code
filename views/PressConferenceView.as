package earthscope.views{		import flash.display.Sprite;	import fl.transitions.Tween;	import fl.transitions.TweenEvent;	import fl.transitions.easing.*;	import flash.utils.Timer;	import flash.events.TimerEvent;	import flash.text.TextField;	import flash.text.TextFormat;	import flash.events.TextEvent;	import flash.text.StyleSheet;	import flash.events.MouseEvent;	import flash.text.TextFieldAutoSize;	import flash.text.AntiAliasType;		import earthscope.utils.DisplayGraphicsFiles;	import earthscope.models.*;	import earthscope.views.MayorView;	import earthscope.utils.PressConferenceButton;	import earthscope.utils.GameButton;	import earthscope.text.GameText;	import earthscope.utils.SoundPlayer;		public class PressConferenceView extends Sprite{				private var _fadeBox:Sprite;		private var _background:DisplayGraphicsFiles = new DisplayGraphicsFiles();		private var _podium:DisplayGraphicsFiles = new DisplayGraphicsFiles();		private var _question:DisplayGraphicsFiles = new DisplayGraphicsFiles();		private var _reply:DisplayGraphicsFiles = new DisplayGraphicsFiles();		private var _response:DisplayGraphicsFiles = new DisplayGraphicsFiles();		private var _mayorView:MayorView;		private var _officeView:OfficeScreenView;		private var _answer1:PressConferenceButton;		private var _answer2:PressConferenceButton;		private var _answer3:PressConferenceButton;		private var _answer4:PressConferenceButton;		private var _questionBack:Sprite = new Sprite();		private var _press:TextField = new TextField();		private var _pressQuestion:TextField = new TextField();				var _wordsPerLine:Number = 42.0				private var _correct:TextField = new TextField();		private var _reason:TextField = new TextField();				private var _format:TextFormat = new TextFormat();		private var _nextBtn:GameButton; 				private var _x:int = GameText.BACK_X;		private var _y:int = GameText.BACK_Y;				private var _timer:Timer;				private var _pressConference:PressConferenceData;				var fadeTween:Tween;		var fadeTween2:Tween;		var fadeTween3:Tween;		var fadeTween4:Tween;		var fadeTween5:Tween;		var fadeTween6:Tween;		var fadeTween7:Tween;		var fadeTween8:Tween;				var _startQuestion:SoundPlayer = new SoundPlayer();		var _backSound:SoundPlayer = new SoundPlayer();								public function PressConferenceView(){			super();			_background.loadFile("pictures/PRESSCONFERENCE/pressBackground.png");			_podium.loadFile("pictures/PRESSCONFERENCE/pressForeground.png");			_reply.loadFile("pictures/PRESSCONFERENCE/textBubble.png");			_response.loadFile("pictures/PRESSCONFERENCE/resultBack.png");			_backSound.loadSound(GameText.SOUNDS_FOLDER + "pressconferenceambience.mp3");											}				public function initPressConference(officeView:OfficeScreenView, mayorView:MayorView, pressConference:PressConferenceData){						trace("Init press conference");						_mayorView = mayorView;			_officeView = officeView;			_pressConference = pressConference;						_fadeBox = new Sprite();			addChild(_fadeBox);									with (_fadeBox.graphics) {                				lineStyle(2, 0x000000);				beginFill(0x344E02, 0.9);                drawRect(0 , 0, 5, 5);                endFill();			}            						fadeTween = new Tween(_fadeBox, "alpha", Strong.easeIn, 0, 1, 2, true);			fadeTween.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler);												_backSound.play(0,10);										}				function motionFinishHandler(event:TweenEvent):void{							addChild(_background);			_background.x = _x;			_background.y = _y;						addChild(_mayorView);			_mayorView.x = 675;									addChild(_podium);			_podium.x = _x;			_podium.y = _y;									addChild(_reply);			_reply.x = _x;			_reply.y = _y;			_reply.scaleY = 0.7;			fadeTween2 = new Tween(_reply, "alpha", Strong.easeIn, 0, 1, 1, true);			fadeTween2.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler2);			}				function motionFinishHandler2(event:TweenEvent):void{						trace("motionFinishHandler2");			_answer1 = new PressConferenceButton(_x + 30, _y + 30, 400, 400, _pressConference.intro);			addChild(_answer1);						_timer = new Timer(3000);			_timer.addEventListener(TimerEvent.TIMER, startQuestions);			_timer.start();		}				private function startQuestions(e:TimerEvent):void{						if(_reply.parent == this){				removeChild(_reply);			}			if(_answer1.parent == this){				removeChild(_answer1);			}						_timer.stop();			_timer.removeEventListener(TimerEvent.TIMER, startQuestions);						addChild(_questionBack);						with (_questionBack.graphics) {			                beginFill(0x669999, 0.8);                drawRoundRect(120 , 330, 750, 100, 20);                endFill();         	}		 		 	fadeTween3 = new Tween(_questionBack, "alpha", Strong.easeIn, 0, 1, 1, true);			fadeTween3.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler3);		 		             		}						function motionFinishHandler3(event:TweenEvent):void{						trace("motionFinishHandler3");			if(_response.parent == this){				removeChild(_response);			}						_format.font = "Arial Black";						if(_pressConference.pressQuestion.length < 80){				_format.size = 26;			}			else{				_format.size = 20;			}			_format.color = 0xFFFFFF;			_press.defaultTextFormat = _format;			_press.text = "PRESS : ";			_press.autoSize = TextFieldAutoSize.LEFT;			_press.selectable = false;			_press.x = 130;			_press.y = 330;			_press.antiAliasType = AntiAliasType.ADVANCED;						_format.color = 0x1822AA;			_pressQuestion.defaultTextFormat = _format;			_pressQuestion.text = _pressConference.pressQuestion;			_pressQuestion.x = 260;			_pressQuestion.y = 330;			_pressQuestion.autoSize = TextFieldAutoSize.LEFT;			_pressQuestion.multiline = true;			_pressQuestion.wordWrap = true;			_pressQuestion.antiAliasType = AntiAliasType.ADVANCED;			_pressQuestion.width = 600;			_pressQuestion.height = 300;						addChild(_press);			addChild(_pressQuestion);						fadeTween4 = new Tween(_reply, "alpha", Strong.easeIn, 0, 1, 3, true);			fadeTween4.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler4);					}				function motionFinishHandler4(event:TweenEvent):void{						addChild(_reply);			_reply.x = 90;			_reply.y = 50;									var lines:Number = Math.ceil(_pressConference.answer(0).length/_wordsPerLine) + Math.ceil(_pressConference.answer(1).length/_wordsPerLine) + Math.ceil(_pressConference.answer(2).length/_wordsPerLine);												if(lines > 3.0){				_reply.height = lines*50;			}			else{				_reply.scaleY = 1.0;			}			fadeTween5 = new Tween(_reply, "alpha", Strong.easeIn, 0, 1, 1, true);			fadeTween5.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler5);											}				function motionFinishHandler5(event:TweenEvent):void{					var yval:Number = 80;			var h:Number = 35;									_answer1 = new PressConferenceButton(120, yval, 450, 100, _pressConference.answer(0));			addChild(_answer1);						var mult:Number = _answer1.numberLines;			if(mult == 0){				mult = 1;			}			yval = yval + mult*h;			_answer2 = new PressConferenceButton(120, yval , 450, 100, _pressConference.answer(1));			addChild(_answer2);			mult= _answer2.numberLines;			if(mult == 0){				mult = 1;			}			yval = yval + mult*h;			_answer3 = new PressConferenceButton(120, yval, 450, 100, _pressConference.answer(2));			addChild(_answer3);						mult= _answer3.numberLines;			if(mult == 0){				mult = 1;			}			yval = yval + mult*h;						_answer4 = new PressConferenceButton(120, yval, 450, 100, _pressConference.lastQuestion);			addChild(_answer4);									_answer1.addEventListener(MouseEvent.CLICK, selectAnswer0);			_answer2.addEventListener(MouseEvent.CLICK, selectAnswer1);			_answer3.addEventListener(MouseEvent.CLICK, selectAnswer2);			_answer4.addEventListener(MouseEvent.CLICK, selectAnswer3);								}				private function loadAnswerScreen(){			fadeTween6 = new Tween(_response, "alpha", Strong.easeIn, 0, 1, 1, true);			fadeTween6.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler6);			addChild(_response);			_response.x = _x;			_response.y = _y;									_reason.x = 350;			_reason.y = 120;			_reason.autoSize = TextFieldAutoSize.LEFT;			_reason.multiline = true;			_reason.wordWrap = true;			_reason.antiAliasType = AntiAliasType.ADVANCED;			_reason.width = 275;			_reason.height = 300;						_officeView.buildScoreBar();														}				function motionFinishHandler6(event:TweenEvent):void{						_nextBtn = new GameButton(435, 360, 100, 100, "Dnext questionD");			addChild(_nextBtn);			_nextBtn.addEventListener(MouseEvent.CLICK, nextQuestion);			addChild(_reason);		}				function motionFinishHandler7(event:TweenEvent):void{						_officeView.onExitPressConference();					}				private function selectAnswer0(e:MouseEvent):void{						_pressConference.reply(0);			_format.size = 16;			_format.color = 0x000000;			_reason.defaultTextFormat = _format;						_reason.text = _pressConference.feedback(0);									loadAnswerScreen();					}				private function selectAnswer1(e:MouseEvent):void{						_pressConference.reply(1);						_format.size = 16;			_format.color = 0x000000;			_reason.defaultTextFormat = _format;						_reason.text = _pressConference.feedback(1);						loadAnswerScreen();		}				private function selectAnswer2(e:MouseEvent):void{						_pressConference.reply(2);									_format.size = 16;			_format.color = 0x000000;			_reason.defaultTextFormat = _format;			_reason.text = _pressConference.feedback(2);			loadAnswerScreen();		}				private function selectAnswer3(e:MouseEvent):void{						endPressConference();					}				private function endPressConference():void{						if(_answer2.parent == this){				removeChild(_answer2);			}			if(_answer3.parent == this){				removeChild(_answer3);			}			if(_answer4.parent == this){				removeChild(_answer4);			}						_answer1.label = _pressConference.conclusion;			_reply.height = 150;									fadeTween7 = new Tween(_fadeBox, "alpha", Strong.easeOut, 1, 0.0, 3, true);			fadeTween7.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler7);			//_officeView.onExitPressConference();						_backSound.stop();					}				private function nextQuestion(e:MouseEvent):void{						fadeTween8 = new Tween(_response, "alpha", Strong.easeOut, 1, 0, 1, true);			fadeTween8.addEventListener(TweenEvent.MOTION_FINISH, motionFinishHandler3);											if(_nextBtn.parent == this){				removeChild(_nextBtn);			}												if(_answer2.parent == this){				removeChild(_answer2);			}						if(_answer3.parent == this){				removeChild(_answer3);			}			if(_answer4.parent == this){				removeChild(_answer4);			}						if(_pressQuestion.parent == this){				removeChild(_pressQuestion);			}									if(_reason.parent == this){								removeChild(_reason);			}						_pressConference.next();						if(_pressConference.noMoreQuestions == true){								endPressConference();							}			else{								if(_reply.parent == this){				removeChild(_reply);				}								if(_answer1.parent == this){				removeChild(_answer1);				}										}					}					}				}